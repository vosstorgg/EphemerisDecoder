# Ephemeris Decoder

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –Ω–∞ FastAPI –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ Swiss Ephemeris (pyswisseph), –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–∏–π API –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ –ø–æ–∑–∏—Ü–∏–π –ø–ª–∞–Ω–µ—Ç, –∞—Å–ø–µ–∫—Ç–æ–≤, –¥–æ–º–æ–≤ –∏ —Ñ–∞–∑ –õ—É–Ω—ã.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üåü –†–∞—Å—á—ë—Ç –ø–æ–∑–∏—Ü–∏–π –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø–ª–∞–Ω–µ—Ç (–°–æ–ª–Ω—Ü–µ, –õ—É–Ω–∞, –ú–µ—Ä–∫—É—Ä–∏–π... –ü–ª—É—Ç–æ–Ω)
- üîÆ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–æ—á–∫–∏ (—É–∑–ª—ã, —Ñ–∏–∫—Ç–∏–≤–Ω—ã–µ –ø–ª–∞–Ω–µ—Ç—ã) –ø–æ –∑–∞–ø—Ä–æ—Å—É
- üìê –†–∞—Å—á—ë—Ç –∞—Å–ø–µ–∫—Ç–æ–≤ –º–µ–∂–¥—É –ø–ª–∞–Ω–µ—Ç–∞–º–∏
- üè† –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≥—Ä–∞–Ω–∏—Ü –¥–æ–º–æ–≤ (Whole Sign)
- üåô –†–∞—Å—á—ë—Ç —Ñ–∞–∑ –õ—É–Ω—ã
- üîê **API –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Å –∫–ª—é—á–∞–º–∏**
- ‚ö° –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å —à–∞–≥–æ–º 1 —á–∞—Å
- üöÄ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π API –Ω–∞ FastAPI
- üõ°Ô∏è Rate limiting –∏ security headers
- üëë –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ API –∫–ª—é—á–∞–º–∏ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### –õ–æ–∫–∞–ª—å–Ω–æ

```bash
pip install -r requirements.txt
uvicorn app:app --reload
```

### –ù–∞ Railway

–ü—Ä–æ–µ–∫—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–≤–µ—Ä–Ω—ë—Ç—Å—è –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ Railway.

## API Endpoints

### GET /planets
–ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π –ø–ª–∞–Ω–µ—Ç –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è –∏ –º–µ—Å—Ç–æ.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `datetime` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π): –í—Ä–µ–º—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ ISO 8601 (YYYY-MM-DDTHH:MM:SS)
- `lat` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π): –®–∏—Ä–æ—Ç–∞ –≤ –≥—Ä–∞–¥—É—Å–∞—Ö
- `lon` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π): –î–æ–ª–≥–æ—Ç–∞ –≤ –≥—Ä–∞–¥—É—Å–∞—Ö
- `extra` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π): –í–∫–ª—é—á–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–æ—á–∫–∏ (true/false)

**–ü—Ä–∏–º–µ—Ä:**
```
GET /planets?datetime=2024-01-15T12:00:00&lat=55.7558&lon=37.6176
```

### GET /aspects
–†–∞—Å—á—ë—Ç –∞—Å–ø–µ–∫—Ç–æ–≤ –º–µ–∂–¥—É –ø–ª–∞–Ω–µ—Ç–∞–º–∏.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `datetime` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π): –í—Ä–µ–º—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ ISO 8601
- `lat` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π): –®–∏—Ä–æ—Ç–∞ –≤ –≥—Ä–∞–¥—É—Å–∞—Ö
- `lon` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π): –î–æ–ª–≥–æ—Ç–∞ –≤ –≥—Ä–∞–¥—É—Å–∞—Ö

### GET /houses
–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≥—Ä–∞–Ω–∏—Ü –¥–æ–º–æ–≤ (Whole Sign).

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `datetime` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π): –í—Ä–µ–º—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ ISO 8601
- `lat` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π): –®–∏—Ä–æ—Ç–∞ –≤ –≥—Ä–∞–¥—É—Å–∞—Ö
- `lon` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π): –î–æ–ª–≥–æ—Ç–∞ –≤ –≥—Ä–∞–¥—É—Å–∞—Ö

### GET /moon_phase
–†–∞—Å—á—ë—Ç —Ñ–∞–∑—ã –õ—É–Ω—ã.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `datetime` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π): –í—Ä–µ–º—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ ISO 8601

## üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

–í—Å–µ API –∑–∞–ø—Ä–æ—Å—ã —Ç—Ä–µ–±—É—é—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ API –∫–ª—é—á. –ö–ª—é—á –¥–æ–ª–∂–µ–Ω –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å—Å—è –æ–¥–Ω–∏–º –∏–∑ —Å–ø–æ—Å–æ–±–æ–≤:

### –°–ø–æ—Å–æ–±—ã –ø–µ—Ä–µ–¥–∞—á–∏ –∫–ª—é—á–∞

1. **HTTP –∑–∞–≥–æ–ª–æ–≤–æ–∫** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):
   ```
   X-API-Key: –≤–∞—à_api_–∫–ª—é—á
   ```

2. **–ü–∞—Ä–∞–º–µ—Ç—Ä –∑–∞–ø—Ä–æ—Å–∞**:
   ```
   ?api_key=–≤–∞—à_api_–∫–ª—é—á
   ```

3. **Authorization header** (Bearer token):
   ```
   Authorization: Bearer –≤–∞—à_api_–∫–ª—é—á
   ```

### –ü–æ–ª—É—á–µ–Ω–∏–µ API –∫–ª—é—á–∞

#### –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è –¥–µ–º–æ-–∫–ª—é—á:
```bash
python run_local.py
```

–ò–ª–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∫–ª—é—á –≤—Ä—É—á–Ω—É—é:
```bash
python generate_demo_key.py
```

#### –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª—é—á–µ–π:
```bash
curl -X POST "http://localhost:8000/admin/keys?name=MyApp&permissions=read" \
  -H "X-API-Key: –≤–∞—à_–∞–¥–º–∏–Ω_–∫–ª—é—á"
```

### –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π

```bash
# –° –∑–∞–≥–æ–ª–æ–≤–∫–æ–º X-API-Key
curl -H "X-API-Key: –≤–∞—à_api_–∫–ª—é—á" \
  "http://localhost:8000/planets?datetime=2024-01-15T12:00:00&lat=55.7558&lon=37.6176"

# –° –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º api_key
curl "http://localhost:8000/planets?datetime=2024-01-15T12:00:00&lat=55.7558&lon=37.6176&api_key=–≤–∞—à_api_–∫–ª—é—á"

# –° Authorization header
curl -H "Authorization: Bearer –≤–∞—à_api_–∫–ª—é—á" \
  "http://localhost:8000/planets?datetime=2024-01-15T12:00:00&lat=55.7558&lon=37.6176"
```

## üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### –°–æ–∑–¥–∞–Ω–∏–µ API –∫–ª—é—á–µ–π
```http
POST /admin/keys?name=AppName&permissions=read,write&expires_days=30&rate_limit=1000
Authorization: Bearer –≤–∞—à_–∞–¥–º–∏–Ω_–∫–ª—é—á
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∫–ª—é—á–µ–π
```http
GET /admin/keys
Authorization: Bearer –≤–∞—à_–∞–¥–º–∏–Ω_–∫–ª—é—á
```

### –û—Ç–∑—ã–≤ –∫–ª—é—á–∞
```http
DELETE /admin/keys/{key_id}
Authorization: Bearer –≤–∞—à_–∞–¥–º–∏–Ω_–∫–ª—é—á
```

### –£—Ä–æ–≤–Ω–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π

- **READ**: –¢–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (–ø–ª–∞–Ω–µ—Ç—ã, –∞—Å–ø–µ–∫—Ç—ã, –¥–æ–º–∞, —Ñ–∞–∑—ã –õ—É–Ω—ã)
- **WRITE**: –ß—Ç–µ–Ω–∏–µ –∏ –∑–∞–ø–∏—Å—å (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏)
- **ADMIN**: –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø + —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ API –∫–ª—é—á–∞–º–∏

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- **Rate limiting**: 100 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É –ø–æ IP + –ª–∏–º–∏—Ç—ã –ø–æ –∫–ª—é—á–∞–º
- **Security headers**: XSS –∑–∞—â–∏—Ç–∞, CSRF –∑–∞—â–∏—Ç–∞, Content-Type sniffing
- **API key hashing**: –ö–ª—é—á–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –≤–∏–¥–µ —Ö–µ—à–µ–π SHA-256
- **Expiration**: –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è –∫–ª—é—á–µ–π
- **Usage tracking**: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ –∫–ª—é—á–∞

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
‚îú‚îÄ‚îÄ app.py                          # –û—Å–Ω–æ–≤–Ω–æ–µ FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îî‚îÄ‚îÄ ephem.py                   # –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞—Å—á—ë—Ç–æ–≤ —ç—Ñ–µ–º–µ—Ä–∏–¥
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îú‚îÄ‚îÄ auth.py                    # üîê –°–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ API –∫–ª—é—á–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ middleware.py              # üõ°Ô∏è Middleware –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
‚îÇ   ‚îî‚îÄ‚îÄ zodiac.py                  # –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ –∑–Ω–∞–∫–∞–º–∏ –∑–æ–¥–∏–∞–∫–∞
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ api_keys.yaml              # üîë –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è API –∫–ª—é—á–µ–π
‚îÇ   ‚îî‚îÄ‚îÄ aspects.yaml               # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∞—Å–ø–µ–∫—Ç–æ–≤
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îú‚îÄ‚îÄ test_auth.py               # üß™ –¢–µ—Å—Ç—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ test_api.py                # –¢–µ—Å—Ç—ã API
‚îÇ   ‚îú‚îÄ‚îÄ test_ephem.py              # –¢–µ—Å—Ç—ã —ç—Ñ–µ–º–µ—Ä–∏–¥
‚îÇ   ‚îî‚îÄ‚îÄ test_zodiac.py             # –¢–µ—Å—Ç—ã —É—Ç–∏–ª–∏—Ç –∑–æ–¥–∏–∞–∫–∞
‚îú‚îÄ‚îÄ examples/
‚îÇ   ‚îî‚îÄ‚îÄ api_usage.py               # üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è API —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
‚îú‚îÄ‚îÄ generate_demo_key.py           # üîë –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–µ–º–æ-API –∫–ª—é—á–µ–π
‚îú‚îÄ‚îÄ run_local.py                   # üöÄ –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ —Å –∞–≤—Ç–æ-–≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –∫–ª—é—á–µ–π
‚îú‚îÄ‚îÄ run_tests.py                   # üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
‚îú‚îÄ‚îÄ test_auth_quick.py             # ‚ö° –ë—ã—Å—Ç—Ä–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ requirements.txt                # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
‚îú‚îÄ‚îÄ Procfile                       # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è Railway
‚îú‚îÄ‚îÄ AUTHENTICATION_GUIDE.md        # üìñ –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ LOCAL_SETUP.md                 # üõ†Ô∏è –õ–æ–∫–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
‚îú‚îÄ‚îÄ PROJECT_OVERVIEW.md            # üìã –û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ RAILWAY_DEPLOYMENT.md          # üöÇ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ Railway
‚îî‚îÄ‚îÄ README.md                      # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
```bash
python run_tests.py
```

### –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
```bash
# –¢–µ—Å—Ç—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
pytest tests/test_auth.py -v

# –¢–µ—Å—Ç—ã API —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
pytest tests/test_api.py -v

# –¢–µ—Å—Ç—ã —ç—Ñ–µ–º–µ—Ä–∏–¥
pytest tests/test_ephem.py -v

# –¢–µ—Å—Ç—ã —É—Ç–∏–ª–∏—Ç –∑–æ–¥–∏–∞–∫–∞
pytest tests/test_zodiac.py -v
```

### –ë—ã—Å—Ç—Ä–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
```bash
python test_auth_quick.py
```

### –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏
```bash
pip install pytest-cov
pytest tests/ --cov=. --cov-report=html
```

## üöÄ –°–∫—Ä–∏–ø—Ç—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞

### –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ —Å –∞–≤—Ç–æ-–≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –∫–ª—é—á–µ–π
```bash
python run_local.py
```

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–µ–º–æ-API –∫–ª—é—á–µ–π
```bash
python generate_demo_key.py
```

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è API
```bash
python examples/api_usage.py
```

## –õ–∏—Ü–µ–Ω–∑–∏—è

Copyright (C) 2024 Ephemeris Decoder

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program.  If not, see <https://www.gnu.org/licenses/>.


